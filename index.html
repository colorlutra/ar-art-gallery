// ... (resizeCanvas関数や変数定義はそのまま) ...

// 描画開始 (mousedown/touchstart)
function startDrawing(e) {
    isDrawing = true;
    e.preventDefault(); 
    
    const clientX = (e.touches ? e.touches[0].clientX : e.clientX);
    const clientY = (e.touches ? e.touches[0].clientY : e.clientY);
    
    // パスを開始し、最初の点を設定 (線を描き始める準備)
    ctx.beginPath(); 
    ctx.moveTo(clientX, clientY);
    
    // 座標を更新
    [lastX, lastY] = [clientX, clientY];
}

// 描画移動 (mousemove/touchmove)
function draw(e) {
    if (!isDrawing) return;

    e.preventDefault(); 
    
    const clientX = (e.touches ? e.touches[0].clientX : e.clientX);
    const clientY = (e.touches ? e.touches[0].clientY : e.clientY);

    // 最後の点から新しい点まで線を引く (パスに追加するだけ)
    ctx.lineTo(clientX, clientY);
    
    // ★ 描画移動中はstroke()を実行せず、描画負荷を最小限に抑える
    // ctx.stroke(); // ← 削除

    // 座標を更新
    [lastX, lastY] = [clientX, clientY];
}

// 描画終了 (mouseup/touchend/mouseout)
function stopDrawing() {
    if (!isDrawing) return;
    
    // ★ 描画終了時に、パス全体を一度に描画し確定させる (安定性の鍵)
    ctx.stroke(); 
    
    isDrawing = false;
}

// ... (イベントリスナーやAR反映ロジックはそのまま) ...
